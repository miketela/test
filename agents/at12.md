# Agente AT12 (Flujo Unificado)

## Propósito
- Liderar `AT12` extremo a extremo: descubrimiento, exploración, transformación y consolidación.

## Entradas y Estructura
- Subtipos esperados (uno por mes): `BASE_AT12`, `TDC_AT12`, `VALORES_AT12`, `SOBREGIRO_AT12`, `AFECTACIONES_AT12`, `GARANTIA_AUTOS_AT12`, `POLIZA_HIPOTECAS_AT12`, `VALOR_MINIMO_AVALUO_AT12`, `AT02_CUENTAS`.
- Directorios: `source/` (entrada), `data/raw/` (espejo versionado), `data/processed/transforms/AT12/` (incidencias, procesados, consolidated), `metrics/`, `reports/`.

## Reglas Clave
- Período por defecto: mes previo; coherencia por nombre `[SUBTYPE]_[YYYYMMDD].CSV`.
- Duplicados: elegir fecha más reciente; emitir `warning`.
- AT02_CUENTAS: mapeo de headers por reemplazo directo (posición).
- Resto: normalización (acentos→ASCII, mayúsculas, underscores, limpiar `(1)`).

## Transformación (resumen por etapas)
- Etapa 1: limpieza estructural (`EEOR TABULAR`, longitudes `Id_Documento`, fechas erradas, comas indebidas).
- Etapa 2: construcción `TDC_AT12`, `SOBREGIRO_AT12`, `VALORES_AT12` a partir de `BASE_AT12` con reglas de campo.
- Etapa 3: reportes operativos (`FUERA_CIERRE_AT12`).
- Etapa 4: validación `VALOR_MINIMO_AVALUO_AT12` con `AT03` (join por `num_cta`).
- Etapa 5: consolidación a TXT (separadores por subtipo; sin header; directorio `consolidated/`).

## Artefactos
- `metrics/exploration_metrics_*.json`, `reports/exploration_*.pdf` y `transformation_*.pdf`.
- Incidencias por etapa en `transforms/AT12/incidencias/`.
- Salidas finales en `transforms/AT12/consolidated/*.txt`.

## Comandos
- Explorar: `python main.py explore --atoms AT12 --year 2025 --month 08`.
- Transformar: `python main.py transform --atoms AT12 --year 2025 --month 08`.
- Reporte: `python main.py report --metrics-file metrics/<json>`.

## Checklist de PRs
- Precondiciones de transformación satisfechas (subtipos presentes, headers válidos).
- Incidencias y artefactos generados con `run_id`.
- Reglas alineadas con `context_files/transform_context.md`.
